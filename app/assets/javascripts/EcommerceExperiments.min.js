define.experiment.Class("ecommerce.converters.EcomCartConverter.EcomTax.New",function(a,b){var c=a;c.methods({convertCart:function(a){if(!a)return this._getDummyData();var b={_type:"Cart",totalPrice:a.cart.total,subTotal:a.cart.subTotal||"",id:a.cart.cartId,items:[],hasCoupon:a.cart.hasCoupon||!1,coupon:{_type:"Coupon",couponCode:"",couponName:"",discountAmount:""},hasFees:a.cart.hasFees||!1,fees:{_type:"Fees",destination:{_type:"Destination",shippable:!1},shippingFees:"",taxFees:""},emptyCartImage:{_type:"wix:Image",title:"Cart",src:"images/empty_cart.png",width:70,height:60},hasShipping:!1};return b.itemsCount=this._populateCartItems(a.productCartItems,b.items),this._setCouponData(a,b),this._setFeesData(a,b),b},_getDummyData:function(){return{_type:"Cart",totalPrice:"",subTotal:"",id:this.NULL_CART_ID,items:[],itemsCount:0,hasCoupon:!1,coupon:{},hasFees:!1,fees:{},emptyCartImage:{_type:"wix:Image",title:"Cart",src:"images/empty_cart.png",width:70,height:60}}},_setCouponData:function(a,b){var c=a.cart.coupon;b.hasCoupon&&c&&(c.name&&(b.coupon.couponName=c.name),b.coupon.discountAmount=c.discountAmount)},_setFeesData:function(a,b){var c=a.cart.fees;b.hasFees&&c&&(b.fees.shippingFees=c.shipping&&c.shipping.cost||"",b.fees.taxFees=c.tax&&c.tax.cost||"",b.fees.destination=this._shippingConverter.convertCartDestination(c.destination),"unresolved"==c.destination.type&&(b.preloadShipping=!0))}})}),define.experiment.Class("ecommerce.converters.EcomShippingConverter.EcomTax.New",function(a,b){var c=a;c.methods({convertCountriesList:function(a){var b=this._getDestinationDataObj();return b.countries.items=a.map(function(a){return this._convertCountryItem(a)},this),b},convertCartDestination:function(a){var b=null;switch(a.type){case"resolved":b={_type:"PredefinedDestination",name:a.name,shippable:!0};break;case"unresolved":b=this._getDestinationDataObj();break;default:b={_type:"Destination",shippable:!1}}return b},_getDestinationDataObj:function(){return{countries:{_type:"ComboOptionsList",selectedValue:-1,items:[]},regions:{_type:"ComboOptionsList",selectedValue:-1,items:[]},shippable:!0,_type:"AdvancedDestination"}}})}),define.experiment.Class("ecommerce.core.EcomCheckoutAPI.WixCheckoutPage.New",function(a){var b=a;b.methods({getCheckoutURL:function(a,b){var c=this._getBaseURL();return c+="storeId="+b,c+="&cartId="+a,c+="&metaSiteId="+this.resources.W.Config.getMetaSiteId(),c+="&paymentMethod=creditCard",c+="&returnToURL="+this._getReturnToURL(window)}})}),define.experiment.Class("ecommerce.core.EcomCheckoutAPI.WixCheckoutPage.Popup",function(a){var b=a;b.methods({getCheckoutURL:function(a,b){var c=this._getBaseURL();return c+="storeId="+b,c+="&cartId="+a,c+="&metaSiteId="+this.resources.W.Config.getMetaSiteId(),c+="&paymentMethod=creditCard",c+="&returnToURL="+this._getReturnToURL(window)}})}),define.experiment.Class("ecommerce.core.EcomDataProvider.EcomTax.New",function(a){var b=a;b.methods({_fetchShippingData:function(a){if(a.preloadShipping){var b=this._itemsCache.get(this.allShippingDestinations);b&&(a.fees.destination=b.getValue())}}})}),define.experiment.Class("ecommerce.parts_logic.EcomCheckoutButtonLogic.WixCheckoutPage.New",function(a){var b=a;b.methods({_initializeInnerData:function(){this._linkData.target="_top"}})}),define.experiment.Class("ecommerce.parts_logic.EcomCheckoutButtonLogic.WixCheckoutPage.Popup",function(a){var b=a;b.methods({_handleCheckout:function(a){return this._validationCallBack&&this._validationCallBack()===!1?(a.cause.event.preventDefault(),!1):(this._getBlockCheckout()?this._preventProceedToCheckout():this._showCheckoutPopup(),void 0)},_showCheckoutPopup:function(){var a=new Element("div",{id:"checkoutPage"}),b=new Element("div");b.addEvent("click",function(){$$("body").getElementById("checkoutPage")[0].dispose()}),b.setStyles({position:"fixed",top:"0",left:"0",right:"0",bottom:"0","background-color":"#333",opacity:"0.8",filter:"alpha(opacity=80)"});var c=new Element("iframe");c.src=this._checkoutAPI.getCheckoutURL(this._dataProvider.getCartId(),this._dataProvider.getStoreId()),c.setStyles({width:"600px",height:"800px",position:"absolute",top:"50%",left:"50%",margin:"-400px 0 0 -300px"}),a.adopt(b),a.adopt(c),$$("body").adopt(a)}})}),define.experiment.Class("ecommerce.parts_logic.EcomJoinedCartLogic.EcomTax.New",function(a,b){var c=a;c.methods({_prepareInnerCompsLogic:function(a,b,c,d){this._cartLogic._addProxyEvents(a,c),this._couponLogic._addProxyEvents(a),this._shippingLogic._addProxyEvents(a),this._chkBtnLogic._addProxyEvents(a),this._chkBtnLogic._initializeInnerData(b),d.getChildValue("hasFees")===!0&&this._chkBtnLogic.setValidationCallBack(this._shippingLogic.validateShipping)}})}),define.experiment.Class("ecommerce.parts_logic.EcomJoinedCartLogic.MobileEcomViews.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.methods({})}),define.experiment.Class("ecommerce.parts_logic.EcomProductsListLogic.EcomPremium.New",function(a,b){var c=a;c.methods({getDataEditingMetaInfo:function(){var a={title:this._localizer.localize("ECOM_GALLERY_PART_NAME"),hasDataSelection:!0,dataSelectionLabel:this._localizer.localize("ECOM_CHOOSE_COLLECTION_FPP"),dataEditingLabel:this._localizer.localize("ECOM_MANAGE_STORE_FPP"),zoomOpenerLabel:this._localizer.localize("ECOM_PRODUCT_PAGE_PART_NAME"),hasDataEdit:!0},b=this.resources.W.Config.getPremiumFeatures();return b.contains("HasECommerce")||(a.partDescription=this._localizer.localize("ECOM_GALLERY_PART_DESCRIPTION")+"<br/><br/>"+this._localizer.localize("ECOM_GALLERY_PART_PREMIUM_PACKAGE_DESCRIPTION")),a}})}),define.experiment.Class("ecommerce.parts_logic.EcomProductsListLogic.MobileEcomViews.New",function(a,b){var c=a;c.methods({getZoomExtraParams:function(){var a={};return this.resources.W.Config.mobileConfig.isMobile()&&(a.hideNextPrevBtns=!0),a}})}),define.experiment.Class("ecommerce.parts_logic.EcomShippingLogic.EcomTax.New",function(a){var b=a;b.methods({_getShippingDataItem:function(){var a=this._environment.getAppPart().getMainProxy().getViewContext();return a.getData().getChildByRef("cart").getChildByRef("fees").getChildByRef("destination")}})}),define.experiment.Class("ecommerce.parts_logic.EcomStoreManageTrait.StoreManagerPopupWidth.New",function(a){var b=a;b.methods({getDataEditDialogParams:function(){this._addPostMessageEvent(this._handleMessageFromManage);var a=window.innerHeight-this.DIALOG_MARGIN;return a=a<this.DIALOG_MIN_HEIGHT?this.DIALOG_MIN_HEIGHT:a,{url:this._getStoreManageURL(),params:{width:992,height:a,title:this._localizer.localize("ECOM_MANAGE_ONLINE_STORE_TITLE"),description:this._localizer.localize("ECOM_MANAGE_ONLINE_STORE_DESC"),dialogSkin:"wysiwyg.editor.skins.dialogs.JustWindowDialogSkin",dialogId:"econManage",nonModal:!1},onClosedCallback:function(){this._dataProvider.reloadAllData()}.bind(this)}}})}),define.experiment.Class("ecommerce.parts_logic.EcomViewCartLogic.MobileEcomViews.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.methods({run:function(a,b,c){var d=this,e=this._environment.getProxyFactory();this._registerViewCartLabel(b),this._dataProvider.getCart(function(b){var f=e.createView(b,a);f.addEvent("open-cart-page",function(a){if(d.resources.W.Config.mobileConfig.isMobile()){a.cause.event.preventDefault();var b=[{title:"cart",_iid:"JoinedCart"}],c="5fca0e8b-a33c-4c18-b8eb-da50d7f31e4a";return d._environment.getAppInstance().getZoomHandler().openZoomForItemsList(b,0,c,{viewName:"Joined_mobile"}),!1}}),c.showProxy(f)})},_registerViewCartLabel:function(a){var b=this,c=function(c){var d=a.viewCartType||b._options[0].value,e=void 0!==a.viewCartText?a.viewCartText:b._cartText;return"totalPrice"==d?e+=c.getChildValue("totalPrice")||"0":"itemsCount"==d&&(e+=c.getChildValue("itemsCount")),b._linkData.label=e,b._linkData.href=b._getLinkToPageHref(a.cartPageLink),b._linkData};this._environment.getDataItemFactory().registerComputedFieldController("viewCartLink","Cart",c,null)},_getLinkToPageHref:function(a){if(!a||this.resources.W.Config.mobileConfig.isMobile())return"";var b=this.resources.W.Data.getDataByQuery("#"+a);return b?"#!"+b.get("title")+"/"+a:""}})}),define.experiment.Class("ecommerce.parts_logic.ProductBundleLogic.MobileEcomViews.New",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config"])),c.methods({_resolveViewName:function(a){return this.resources.W.Config.mobileConfig.isMobile()&&(a+="_mobile"),a},_addProxyEvents:function(a,b){a.addEvent("productOptionChanged",function(a){this._handleOptionSelectionChanged(b,a)}.bind(this)),a.addEvent("buy-product",function(){this._handleBuyProduct(b)}.bind(this)),a.addEvent("image-selected",function(a){this._handleImageSelected(b,a)}.bind(this)),a.addEvent("shareProductPage",function(a){this._socialSharer.handleShareRequest(a.params.service,b)}.bind(this)),a.addEvent("goto-product",function(a){var b=a.params.cmd;this.resources.W.Commands.executeCommand(b,null,this)}.bind(this))},_handleBuyProduct:function(a){var b=a.getChildByRef("options"),c=this._validateProductOptions(b),d=this._optionsItemsRelations._selectedOptions.map(function(a){return a.selectedOptionId}),e=this._optionsItemsRelations.getProductItem(a,d);if(e&&c){var f=this._getTextOptionsParams(b),g=e.getChildValue("id");if(this._cartAPI.addProduct(g,f),this._logger.sendEcomEvent(this._logger.PRODUCT_PAGE_ADD_PRODUCT_TO_CART,{c1:g}),this.resources.W.Config.mobileConfig.isMobile()){var h=[{title:"cart",_iid:"JoinedCart"}],i="5fca0e8b-a33c-4c18-b8eb-da50d7f31e4a";this._environment.getAppInstance().getZoomHandler().openZoomForItemsList(h,0,i,{viewName:"Joined_mobile"})}else this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close",null,this)}}})});